{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Hello, world!</title>
<style>
  .modal {
    transition: opacity 0.25s ease;
  }
  body.modal-active {
    overflow-x: hidden;
    overflow-y: visible !important;
  }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>

  // function for add province card
  const addCard = province => {
    $(".row").append(`
    <div class="col px-4">
      <div class="
            bg-white
            mx-auto
            max-w-2xl
            rounded-lg
            my-8
            p-16
          ">
        <h1 class="text-2xl font-medium">${ province.fields.title }</h1>
        <p>${ province.fields.summary }</p>
        <div class="flex mt-10 w-fit items-center space-x-3 py-3 px-6 bg-indigo-600 text-white rounded-lg  transition-all duration-400 transform hover:scale-105 cursor-pointer hover:shadow-lg">
          <a href="detail/${ province.pk }/">
            <button class="text-lg text-md">Detail</button>
          </a>
        </div>
        <div class="flex mt-10 w-fit items-center space-x-3 py-3 px-6 bg-indigo-600 text-white rounded-lg  transition-all duration-400 transform hover:scale-105 cursor-pointer hover:shadow-lg">
          <button class="text-lg text-md" onclick=deleteProvince(${province.pk})>Delete</button>
        </div>
        
      </div>
    </div>`);
  }

  // get data json
  const getData = () => {
    $.ajax({
      url: 'json/',
      type: "GET",
      dataType: "json",
      success: function (data) {
        data.forEach(province => {
          addCard(province);
        });
      },
      error: function (data) {
        console.log(data);
      }
    });
  }

  // get data when page loaded
  $(document).ready(function () {
    getData();
  });

  // function handler for add province asynchronously
  var addProvince = function() {
    var formData = $("#add-province").serialize();

    if ($("#title").val() && $("#header").val() && $('#summary')) { // ensure the form is filled
      $.ajax({
        type: "POST",
        url: "addProvince/",
        data: formData,
        dataType: "json",
        encode: true,
      }).done(function (data) {
        addCard(data);
        $("#add-province").trigger("reset");
      })
    }
  }

  // function handler for delete province asynchronously
  var deleteProvince = function(id) {
    $.ajax({
      type: "DELETE",
      headers: { "X-CSRFToken": document.getElementsByName("csrfmiddlewaretoken")[0].value },
      url: "deleteProvince/<int:pk>/".replace('<int:pk>', id),
      data: {
        id: id
      },
      dataType: "json",
      encode: true,
    }).done(function (data) {
      $(`#province-${id}`).remove();
    })
  }
</script>

{% endblock meta %}


{% block content %}
<div class="md:flex items-center p-16 mt-20">
  <div class="">
    <h1 class="lg:text-5xl  font-bold leading-tight text-3xl">What makes this country a wonderful place to visit.</h1>
    <p class="mt-4 text-lg font-normal">Having stopover in myriad places in Indonesia is what makes this country a wonderful place to visit. The beauty of scenic natural landscapes blended with various unique culture of its people. Enjoy the untouched beaches, mountains, lakes, and many more pleasing destinations as well as the magnificent city skylines throughout the country. And when you decide to see them all, a visit wonâ€™t be enough to embrace the wonders of Indonesia.</p>
    <div class="flex mt-10 w-fit items-center space-x-3 py-3 px-6 bg-indigo-600 text-white rounded-lg  transition-all duration-400 transform hover:scale-105 cursor-pointer hover:shadow-lg">
      <button class="modal-open text-lg text-md ">Add Province</button>
    </div>
 </div>
</div>

<body class="bg-gray-200 flex items-center justify-center h-screen">
  
  <!-- <div class="flex justify-center">
    <button class="modal-open w-fit items-center space-x-3 py-3 px-6 bg-indigo-600 text-white rounded-lg  transition-all duration-400 transform hover:scale-105 cursor-pointer hover:shadow-lg">Open Modal</button>
  </div> -->
  
  
  <!--Modal-->
  <div class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center">
    <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
    
    <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
      
      <!-- <div class="modal-close absolute top-0 right-0 cursor-pointer flex flex-col items-center mt-4 mr-4 text-white text-sm z-50">
        <svg class="fill-current text-white" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
          <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
        </svg>
        <span class="text-sm">(Esc)</span>
      </div> -->

      <!-- Add margin to see some of the overlay behind the modal-->
      <div class="modal-content py-4 text-left px-6">
        <!--Title-->
        <div class="flex justify-between items-center pb-3">
          <p class="text-2xl font-bold">Add New Province</p>
          <div class="modal-close cursor-pointer z-50">
            <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
              <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
            </svg>
          </div>
        </div>

        <!--Body-->
        <form id="add-province" action="" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="title">
              Title
            </label>
            <input type="text" id="title" name="title" class="form-control shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="header">
              Header
            </label>
            <textarea type="text" id="header" name="header" class="form-control shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="summary">
              Summary
            </label>
            <textarea type="text" id="summary" name="summary" cols="60" rows="5" class="form-control shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
          </div>
          
          <!-- <input type="text" id="title" name="title" placeholder="Title" class="form-control" maxlength="255" required> -->
          <!-- <input type="text" id="header" name="header" placeholder="Header" class="form-control" maxlength="255" required> -->
          <!-- <input type="text" id="summary" name="summary" placeholder="Summary" class="form-control" maxlength="255" required> -->
          <!-- <textarea name="description" id="description" cols="40" rows="10" placeholder="Description" class="form-control" required="" id="id_description"></textarea> -->

        </form>
        

        <!--Footer-->
        <div class="flex justify-end pt-2">
          <button onclick="addProvince()" name="submit" class="modal-close px-4 bg-transparent p-3 rounded-lg text-indigo-500 hover:bg-gray-100 hover:text-indigo-400 mr-2">Add</button>
          <button class="modal-close px-4 bg-indigo-500 p-3 rounded-lg text-white hover:bg-indigo-400">Close</button>
        </div>
        
      </div>
    </div>
  </div>

  <script>
    var openmodal = document.querySelectorAll('.modal-open')
    for (var i = 0; i < openmodal.length; i++) {
      openmodal[i].addEventListener('click', function(event){
    	event.preventDefault()
    	toggleModal()
      })
    }
    
    const overlay = document.querySelector('.modal-overlay')
    overlay.addEventListener('click', toggleModal)
    
    var closemodal = document.querySelectorAll('.modal-close')
    for (var i = 0; i < closemodal.length; i++) {
      closemodal[i].addEventListener('click', toggleModal)
    }
    
    document.onkeydown = function(evt) {
      evt = evt || window.event
      var isEscape = false
      if ("key" in evt) {
    	isEscape = (evt.key === "Escape" || evt.key === "Esc")
      } else {
    	isEscape = (evt.keyCode === 27)
      }
      if (isEscape && document.body.classList.contains('modal-active')) {
    	toggleModal()
      }
    };
    
    
    function toggleModal () {
      const body = document.querySelector('body')
      const modal = document.querySelector('.modal')
      modal.classList.toggle('opacity-0')
      modal.classList.toggle('pointer-events-none')
      body.classList.toggle('modal-active')
    }
    
     
  </script>
</body>

<div class="container-xl">
  <div class="row rows-cols-1 row-cols-md-3 g-4 justify-content-center">
  </div>
</div>

<!-- {% for recommendation in recommendationList %}
<div class="px-4">
  <div class="
        bg-white
        mx-auto
        max-w-2xl
        rounded-lg
        my-8
        p-16
      ">
    <h1 class="text-2xl font-medium">{{ recommendation.title }}</h1>
    <p>{{ recommendation.summary }}</p>
    <p class="mt-4 text-lg font-normal">{{ recommendation.description }}</p>
    <div class="flex mt-10 w-fit items-center space-x-3 py-3 px-6 bg-indigo-600 text-white rounded-lg  transition-all duration-400 transform hover:scale-105 cursor-pointer hover:shadow-lg">
      <a href="detail/{{ recommendation.id }}">
        <button class="text-lg text-md">Detail</button>
      </a>
    </div>
  </div>
</div>
{% endfor %} -->




<div class="px-4">
  <div class="
        flex
        justify-center
        items-center
        bg-white
        mx-auto
        max-w-2xl
        rounded-lg
        my-16
        p-16
      ">
    <h1 class="text-2xl font-medium">Recommendation page</h1>
  </div>
</div>
{% endblock content %}